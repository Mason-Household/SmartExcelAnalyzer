trigger:
  branches:
    exclude:
      - '*'

pr:
  branches:
    include:
      - main

jobs:
- job: BuildAndDeploy
  displayName: 'Build and Deploy Docker Compose'
  pool:
    vmImage: 'ubuntu-latest'

  steps:
  - task: DockerCompose@0
    displayName: 'Build and Run Docker Compose'
    inputs:
      containerregistry: '$(dockerRegistryServiceConnection)'
      dockerComposeFile: '**/docker-compose.yml'
      action: 'Run services'
      detached: true

  - task: DockerCompose@0
    displayName: 'Tear Down Docker Compose'
    inputs:
      containerregistry: '$(dockerRegistryServiceConnection)'
      dockerComposeFile: '**/docker-compose.yml'
      action: 'Down'
      options: '--volumes'
    condition: always()